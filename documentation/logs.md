
<!-- documentation/logs - Describing the drial log file. -->

# drial - Logs

To help with debugging drial writes a log file at the end of each test run.  The log file is written to a file named *log.json* at this application's project directory as a single large JSON object.  The content of this log file is specific to the API defined by the [Chrome DevTools Protocol (CDP)](https://chromedevtools.github.io/devtools-protocol/).

## Log schema

```typescript
type devtoolsParameters = extendedParameters & (Protocol.Page.AddScriptToEvaluateOnNewDocumentRequest | Protocol.Page.NavigateRequest | Protocol.Page.ReloadRequest | Protocol.Runtime.EvaluateRequest);
interface extendedParameters {
    id?: number;
    method?: string;
    page?: string;
    testId?: number;
    testName?: string;
}
interface messageLog {
    devtool_targets: targetList;
    events: devtoolsParameters[];
    response: devtoolsParameters[];
    sent: messageItem[];
    summary: {
        events: string[];
        response: string[];
        sent: string[];
    };
}
interface targetList {
    [key: string]: targetListItem[];
}
interface targetListItem extends Protocol.Target.TargetInfo {
    id: string;
    ready: boolean;
    ws?: any;
}
```

Notes:
* **messageLog** is the primary structure mentioned above and the other interfaces are supporting structures.
* **Protocol** refers to the **external** devtools types prepared by Paul Irish of Google for compatibility with TypeScript applications such as drial.  These types are included as `import { Protocol } from "devtools-protocol";` where *devtools-protocol* is an NPM package specified in the tsconfig.json as a type root path.
* **ws** is a popular web socket dependency used to communicate with the browser.

## Log sections (child objects)
* **devtools_targets** - Each piece of HTML in the browser is a separate target uniquely and independently accessed from other browser targets.  This includes pages whether they are tabs or different windows.  It also includes iframes, each devtools instance, and a few other things.  Since each target is independently accessed via web sockets I attach a created web socket instance on each page target.  At this time the application is not communicating with iframe content or manipulating devtools features though the CDP allows for that.
* **events** - This is a list of messages generated by the browser and sent to the web socket client.  These messages describe behaviors and automation that occurs in all opened targets unrelated to messages sent to the browser.
* **response** - This is a list of messages generated directly in response to messages sent to the browser.  Each of these messages contain an id property indicating which *sent* message they are in response to.
* **sent** - This is a list of messages generated by the drial application and sent to the browser.  Each of these messages contain an id property as required by the CDP.
* **summary** - Because the various message digests can become large and verbose a summary section is provided at the bottom of the log to summarize the *events*, *response*, and *sent* lists.  The values provided in the summary are a number and a single descriptive artifact of the message instance.